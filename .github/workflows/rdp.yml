
name: üñ•Ô∏è Windows RDP with Cloudflared

on:
  workflow_dispatch:

jobs:
  rdp:
    runs-on: windows-latest
    timeout-minutes: 360
    
    steps:
    - name: üîß Setup RDP
      run: |
        # Enable RDP
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        
        # Create RDP user
        net user RDPUser Password123! /add /y
        net localgroup administrators RDPUser /add
        net localgroup "Remote Desktop Users" RDPUser /add

    - name: üì• Install Cloudflared
      run: |
        # Download and install Cloudflared
        Invoke-WebRequest -Uri "https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe" -OutFile "cloudflared.exe"
        .\cloudflared.exe --version

    - name: üåê Create Cloudflare Tunnel
      run: |
        # Create tunnel and get URL
        Start-Process -FilePath "cloudflared.exe" -ArgumentList "tunnel --url rdp://localhost:3389" -NoNewWindow
        Start-Sleep -Seconds 10
        
        # Get tunnel URL (Cloudflared shows it in logs)
        Write-Host "=== RDP ACCESS ==="
        Write-Host "Cloudflared tunnel starting..."
        Write-Host "Check logs above for tunnel URL"
        Write-Host "Username: RDPUser"
        Write-Host "Password: Password123!"
        Write-Host "=================="

    - name: üîÑ Keep Alive
      run: |
        # Keep the workflow running
        while ($true) {
          Write-Host "[$(Get-Date)] RDP Active - Tunnel running"
          Write-Host "Look for Cloudflared tunnel URL in previous step logs"
          Write-Host "Use Ctrl+C in workflow to terminate"
          Start-Sleep -Seconds 60
        }
